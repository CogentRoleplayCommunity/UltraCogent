#! /bin/bash

# This script will generate a new Projects.html and Articles.html in the PageContent directory, adding a link to every project it finds in the PageContent/Projects folder... 
# This should be automatically called by the construct script...

# Generating Projects.html
if [[ -f ./PageContent/Projects.html ]]
then
  rm ./PageContent/Projects.html
fi
if [[ ! -z $(ls ./PageContent/Projects/Description) || ! -z $(ls -p ./PageContent/Archived/Description) ]]
then
  echo "Generating Projects.html"
  touch ./PageContent/Projects.html
  echo '<!-- This page is generated by the ProjectsGenerator.sh script which is automatically called by the Consturct.sh scipt. Do not bother manually editing it, it is re-generated each time... -->' > ./PageContent/Projects.html

  cd ./PageContent/Projects/Description
  List=$(ls | grep "D-*")
  cd ..
  cd ..
  cd ..

  if [[ ! -z $List ]]
  then
    echo '<h1 style="text-align: center">Our Projects</h1>' >> ./PageContent/Projects.html
    for i in $List
    do
      if [[ ! -e ./PageContent/Projects/${i:2:250}.html ]]
      then
        Category=$(grep "<!--CategoryMarker-->" ./PageContent/Projects/A-${i:2:250}.html | awk '{ print $2 }')
      else
        Category=$(grep "<!--CategoryMarker-->" ./PageContent/Projects/${i:2:250}.html | awk '{ print $2 }')
      fi
      if [[ -z $Category ]]
      then
        Category=Undefined
      fi
      # Dark version (light version is generated by construct.sh)
      echo '<div class="Centered">' >> ./PageContent/Projects.html
      echo -n '  <a href="./Projects/' >> ./PageContent/Projects.html
      echo -n "${i:2:250}.html" >> ./PageContent/Projects.html
      echo '">' >> ./PageContent/Projects.html
      echo '    <div class="TranslucentPanel">' >> ./PageContent/Projects.html
      echo '      <div class="PanelArea">' >> ./PageContent/Projects.html
      echo '        <table style="border: 0px; padding: 0px; margin: 0px">' >> ./PageContent/Projects.html
      echo '          <tr style="border: 0px; padding: 0px; margin: 0px">' >> ./PageContent/Projects.html
      echo '            <td style="border: 0px; padding: 0px; margin: 0px; width: 75px">' >> ./PageContent/Projects.html
      echo -n '              <img style="width: 75px; height: 75px" src="./Images/ProjectPages/' >> ./PageContent/Projects.html
      if [[ ! -e ./Images/ProjectPages/C-$Category.svg ]]
      then
        echo -n "C-$Category.png" >> ./PageContent/Projects.html
      else
        echo -n "C-$Category.svg" >> ./PageContent/Projects.html
      fi
      echo '">' >> ./PageContent/Projects.html
      echo '            </td>' >> ./PageContent/Projects.html
      echo '            <td style="border: 0px; padding: 0px; margin: 0px; width: 5px">' >> ./PageContent/Projects.html
      echo '            </td>' >> ./PageContent/Projects.html
      echo '            <td style="border: 0px; padding: 0px; margin: 0px">' >> ./PageContent/Projects.html
      echo -n '              <span class="ProjectList">' >> ./PageContent/Projects.html
      if [[ ! -e ./PageContent/Projects/${i:2:250}.html ]]
      then
        Title="$(grep 'TitleMarker' ./PageContent/Projects/A-${i:2:250}.html)"
      else
        Title="$(grep 'TitleMarker' ./PageContent/Projects/${i:2:250}.html)"
      fi
      echo ${Title:49:300} >> ./PageContent/Projects.html
      echo '              </span><br>' >> ./PageContent/Projects.html
      echo -n '              <span class="ProjectListDescription">' >> ./PageContent/Projects.html
      cat ./PageContent/Projects/Description/$i >> ./PageContent/Projects.html
      echo '              </span>' >> ./PageContent/Projects.html
      echo '            </td>' >> ./PageContent/Projects.html
      echo '          </tr>' >> ./PageContent/Projects.html
      echo '        </table>' >> ./PageContent/Projects.html
      echo '      </div>' >> ./PageContent/Projects.html
      echo '    </div>' >> ./PageContent/Projects.html
      echo '  </a>' >> ./PageContent/Projects.html
      echo '</div>' >> ./PageContent/Projects.html
      echo '<br>' >> ./PageContent/Projects.html
    done
  fi

  cd ./PageContent/Archived/Description
  List=$(ls | grep "D-*")
  cd ..
  cd ..
  cd ..

  if [[ ! -z $List ]]
  then
    echo '<h1 style="text-align: center">Our Archived Projects</h1>' >> ./PageContent/Projects.html
    for i in $List
    do
      Category=$(grep "<!--CategoryMarker-->" ./PageContent/Archived/${i:2:250}.html | awk '{ print $2 }')
      if [[ -z $Category ]]
      then
        Category=Undefined
      fi
      # Dark version (light version is generated by construct.sh)
      echo '<div class="Centered">' >> ./PageContent/Projects.html
      echo -n '  <a href="./Archived/' >> ./PageContent/Projects.html
      echo -n "${i:2:250}.html" >> ./PageContent/Projects.html
      echo '">' >> ./PageContent/Projects.html
      echo '    <div class="TranslucentPanel">' >> ./PageContent/Projects.html
      echo '      <div class="PanelArea">' >> ./PageContent/Projects.html
      echo '        <table style="border: 0px; padding: 0px; margin: 0px">' >> ./PageContent/Projects.html
      echo '          <tr style="border: 0px; padding: 0px; margin: 0px">' >> ./PageContent/Projects.html
      echo '            <td style="border: 0px; padding: 0px; margin: 0px; width: 75px">' >> ./PageContent/Projects.html
      echo -n '              <img style="width: 75px; height: 75px" src="./Images/ProjectPages/' >> ./PageContent/Projects.html
      if [[ ! -e ./Images/ProjectPages/C-$Category.svg ]]
      then
        echo -n "C-$Category.png" >> ./PageContent/Projects.html
      else
        echo -n "C-$Category.svg" >> ./PageContent/Projects.html
      fi
      echo '">' >> ./PageContent/Projects.html
      echo '            </td>' >> ./PageContent/Projects.html
      echo '            <td style="border: 0px; padding: 0px; margin: 0px; width: 5px">' >> ./PageContent/Projects.html
      echo '            </td>' >> ./PageContent/Projects.html
      echo '            <td style="border: 0px; padding: 0px; margin: 0px">' >> ./PageContent/Projects.html
      echo -n '              <span class="ProjectList">' >> ./PageContent/Projects.html
      Title="$(grep 'TitleMarker' ./PageContent/Archived/${i:2:250}.html)"
      echo ${Title:49:300} >> ./PageContent/Projects.html
      echo '              </span><br>' >> ./PageContent/Projects.html
      echo -n '              <span class="ProjectListDescription">' >> ./PageContent/Projects.html
      cat ./PageContent/Archived/Description/$i >> ./PageContent/Projects.html
      echo '              </span>' >> ./PageContent/Projects.html
      echo '            </td>' >> ./PageContent/Projects.html
      echo '          </tr>' >> ./PageContent/Projects.html
      echo '        </table>' >> ./PageContent/Projects.html
      echo '      </div>' >> ./PageContent/Projects.html
      echo '    </div>' >> ./PageContent/Projects.html
      echo '  </a>' >> ./PageContent/Projects.html
      echo '</div>' >> ./PageContent/Projects.html
      echo '<br>' >> ./PageContent/Projects.html
    done
  fi
fi

# Generating Articles.html
if [[ -f ./PageContent/Articles.html ]]
then
  rm ./PageContent/Articles.html
fi
if [[ ! -z $(ls ./PageContent/Articles/Description) ]]
then
  echo "Generating Articles.html"
  touch ./PageContent/Articles.html
  echo '<!-- This page is generated by the ProjectsGenerator.sh script which is automatically called by the Consturct.sh scipt. Do not bother manually editing it, it is re-generated each time... -->' > ./PageContent/Articles.html

  cd ./PageContent/Articles/Description
  List=$(ls | grep "D-*")
  cd ..
  cd ..
  cd ..

  if [[ ! -z $List ]]
  then
    echo '<h1 style="text-align: center">Articles</h1>' >> ./PageContent/Articles.html
    for i in $List
    do
      # Dark version (light version is generated by construct.sh)
      echo '<div class="Centered">' >> ./PageContent/Articles.html
      echo -n '  <a href="./Articles/' >> ./PageContent/Articles.html
      echo -n "${i:2:250}.html" >> ./PageContent/Articles.html
      echo '">' >> ./PageContent/Articles.html
      echo '    <div class="TranslucentPanel">' >> ./PageContent/Articles.html
      echo '      <div class="PanelArea">' >> ./PageContent/Articles.html
      echo -n '        <span class="ProjectList">' >> ./PageContent/Articles.html
      if [[ ! -e ./PageContent/Articles/${i:2:250}.html ]]
      then
        Title="$(grep 'TitleMarker' ./PageContent/Articles/A-${i:2:250}.html)"
      else
        Title="$(grep 'TitleMarker' ./PageContent/Articles/${i:2:250}.html)"
      fi
      echo ${Title:49:300} >> ./PageContent/Articles.html
      echo '        </span><br>' >> ./PageContent/Articles.html
      echo -n '        <span class="ProjectListDescription">' >> ./PageContent/Articles.html
      cat ./PageContent/Articles/Description/$i >> ./PageContent/Articles.html
      echo '        </span>' >> ./PageContent/Articles.html
      echo '      </div>' >> ./PageContent/Articles.html
      echo '    </div>' >> ./PageContent/Articles.html
      echo '  </a>' >> ./PageContent/Articles.html
      echo '</div>' >> ./PageContent/Articles.html
      echo '<br>' >> ./PageContent/Articles.html
    done
  fi
fi
